<!DOCTYPE html>
<html>
<head>
<style>
  * { margin: 0; padding: 0 }
  body { background: #06080f; overflow: hidden }
  canvas { display: block }
  #pick { position: fixed; top: 50%; left: 50%; transform: translate(-50%,-50%); z-index: 10; color: #888; font: 16px sans-serif; text-align: center }
</style>
</head>
<body>
<div id="pick">
  <p>Select your KSA map image</p>
  <input type="file" id="fi" accept="image/*">
</div>
<canvas id="c"></canvas>
<script>
var c = document.getElementById('c'), x = c.getContext('2d');
c.width = innerWidth; c.height = innerHeight;

document.getElementById('fi').onchange = function(e) {
  var f = e.target.files[0]; if (!f) return;
  document.getElementById('pick').style.display = 'none';
  var r = new FileReader();
  r.onload = function(ev) {
    var img = new Image();
    img.onload = function() { go(img) };
    img.src = ev.target.result;
  };
  r.readAsDataURL(f);
};

function go(img) {
  var W = c.width, H = c.height;
  var sc = Math.min(W / img.width, H / img.height) * 0.85;
  var iw = img.width * sc, ih = img.height * sc;
  var ox = (W - iw) / 2, oy = (H - ih) / 2;

  var h = document.createElement('canvas');
  h.width = W; h.height = H;
  var hx = h.getContext('2d');
  hx.drawImage(img, ox, oy, iw, ih);
  var pd = hx.getImageData(0, 0, W, H).data;

  function dark(px, py) {
    var i = (Math.floor(py) * W + Math.floor(px)) * 4;
    return pd[i+3] > 100 && pd[i] < 80 && pd[i+1] < 80 && pd[i+2] < 90;
  }

  var dots = [], att = 0;
  while (dots.length < 600 && att < 20000) {
    var dx = ox + Math.random() * iw, dy = oy + Math.random() * ih;
    if (dark(dx, dy)) {
      dots.push({ x: dx, y: dy, sp: 0.001 + Math.random() * 0.008, ph: Math.random() * Math.PI * 2, r: 0.5 + Math.random() * 1.2 });
    }
    att++;
  }

  var t0 = Date.now();
  function draw() {
    var t = Date.now() - t0;
    x.fillStyle = '#06080f';
    x.fillRect(0, 0, W, H);
    x.save(); x.globalAlpha = 0.12;
    x.drawImage(img, ox, oy, iw, ih);
    x.restore();
    for (var i = 0; i < dots.length; i++) {
      var d = dots[i];
      var a = (Math.sin(t * d.sp + d.ph) * 0.5 + 0.5) * 0.7;
      if (a < 0.02) continue;
      x.beginPath();
      x.arc(d.x, d.y, d.r, 0, Math.PI * 2);
      x.fillStyle = 'rgba(255,255,255,' + a + ')';
      x.fill();
    }
    requestAnimationFrame(draw);
  }
  draw();
}
</script>
</body>
</html>